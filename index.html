<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Понг (Вертикальный Формат)</title>
    <!-- Загрузка Tailwind CSS для базовой стилизации -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Общие стили для темного, игрового вида */
        body {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #0d1117; 
            color: #ffffff;
            overflow: hidden; 
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 90vw;
            max-height: 90vh;
            padding: 20px;
            background-color: #161b22;
            border-radius: 12px;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.3); 
        }

        /* Стиль для игрового холста */
        canvas {
            display: block;
            border: 2px solid #38ff38; 
            background-color: #010409;
            touch-action: none; 
            max-height: 80vh; 
            max-width: 90vw;
        }

        /* Стиль для кнопки */
        button {
            transition: all 0.1s ease-in-out;
            box-shadow: 0 4px 15px rgba(56, 255, 56, 0.4);
        }

        button:hover {
            box-shadow: 0 6px 20px rgba(56, 255, 56, 0.6);
            transform: translateY(-1px);
        }

        button:active {
            transform: scale(0.98);
            box-shadow: none;
        }

        #score {
            font-size: 2.5rem;
            font-weight: bold;
            color: #38ff38;
            text-shadow: 0 0 10px #38ff38;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div id="game-container" class="space-y-4">
        <h1 class="text-2xl font-bold text-[#38ff38] text-shadow: 0 0 5px #38ff38">Понг (Вертикальный)</h1>

        <!-- Отображение счета -->
        <div id="score" class="text-center">
            <span id="score-p1">0</span> : <span id="score-p2">0</span>
        </div>

        <!-- Игровой холст -->
        <canvas id="pongCanvas"></canvas>

        <!-- Кнопка запуска/перезапуска -->
        <button id="startButton" 
                class="bg-[#38ff38] text-gray-900 py-2 px-6 rounded-lg font-semibold 
                       hover:bg-[#6cff6c] focus:outline-none focus:ring-4 focus:ring-[#38ff38] transition">
            Начать Игру
        </button>
        
        <!-- Сообщение в центре экрана (скрыто) -->
        <div id="messageBox" 
             class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 
                    bg-gray-800 p-6 rounded-xl shadow-xl border-2 border-green-500 
                    text-white text-xl font-bold z-10 hidden">
            <!-- Сообщение будет здесь -->
        </div>

    </div>

    <script>
        // Инициализация переменных Canvas
        const canvas = document.getElementById('pongCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const scoreP1 = document.getElementById('score-p1');
        const scoreP2 = document.getElementById('score-p2');
        const messageBox = document.getElementById('messageBox');

        // Константы и настройки игры (Теперь ракетки широкие и низкие)
        const PADDLE_WIDTH = 80;    // Ширина ракетки (по горизонтали)
        const PADDLE_HEIGHT = 10;   // Высота ракетки (по вертикали)
        const BALL_SIZE = 10;
        const MAX_SCORE = 5; 

        let gameRunning = false;
        let animationFrameId;

        // Состояние игры. P1 (Человек) - снизу, P2 (AI) - сверху
        let player1 = {
            x: 0,
            y: 0, // Фиксированная позиция Y (внизу)
            score: 0
        };

        let player2 = {
            x: 0,
            y: 0, // Фиксированная позиция Y (вверху)
            score: 0
        };

        let ball = {
            x: 0,
            y: 0,
            velX: 0,
            velY: 0,
            speed: 5
        };

        // Соотношение сторон (Ширина к Высоте): 3:4
        const ASPECT_RATIO = 3 / 4; 

        // --- Функции управления игрой ---

        /** Сбрасывает мяч в центр и задает случайное начальное направление (теперь вертикальное) */
        function resetBall() {
            ball.x = canvas.width / 2 - BALL_SIZE / 2;
            ball.y = canvas.height / 2 - BALL_SIZE / 2;
            
            // Угол (не слишком горизонтальный)
            let angle = Math.random() * (Math.PI / 2) - Math.PI / 4; 
            
            // Выбор направления (вверх или вниз)
            const direction = Math.random() < 0.5 ? 1 : -1; 
            
            ball.velX = ball.speed * Math.sin(angle);
            ball.velY = direction * ball.speed * Math.cos(angle);
        }

        /** Инициализирует или перезапускает игру */
        function startGame() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
            }
            
            player1.score = 0;
            player2.score = 0;
            
            // Инициализация позиций X (по центру)
            player1.x = canvas.width / 2 - PADDLE_WIDTH / 2;
            player2.x = canvas.width / 2 - PADDLE_WIDTH / 2;

            // Инициализация позиций Y (фиксировано)
            player1.y = canvas.height - PADDLE_HEIGHT;
            player2.y = 0; 
            
            updateScoreDisplay();
            resetBall();
            
            hideMessage();
            gameRunning = true;
            startButton.textContent = 'Перезапустить игру';
            
            animate();
        }

        /** Отображает сообщение о победе/поражении */
        function showMessage(text) {
            messageBox.textContent = text;
            messageBox.classList.remove('hidden');
        }

        /** Скрывает сообщение */
        function hideMessage() {
            messageBox.classList.add('hidden');
        }

        /** Проверяет условия победы */
        function checkWinCondition() {
            if (player1.score >= MAX_SCORE) {
                gameRunning = false;
                showMessage('Игрок 1 Победил! Нажмите "Перезапустить".');
            } else if (player2.score >= MAX_SCORE) {
                gameRunning = false;
                showMessage('Игрок 2 Победил! Нажмите "Перезапустить".');
            }
        }

        // --- Игровая логика ---

        /** Обновление положения мяча и коллизии */
        function update() {
            if (!gameRunning) return;

            // 1. Движение мяча
            ball.x += ball.velX;
            ball.y += ball.velY;

            // 2. Коллизия с левым/правым краем
            if (ball.x < 0 || ball.x + BALL_SIZE > canvas.width) {
                ball.velX = -ball.velX; // Отскок по горизонтали
            }

            // 3. Коллизия с ракеткой Игрока 1 (Снизу)
            if (ball.y + BALL_SIZE > player1.y) {
                if (ball.x + BALL_SIZE > player1.x && ball.x < player1.x + PADDLE_WIDTH) {
                    ball.velY = -ball.velY; // Отскок от ракетки 1
                    // Корректировка горизонтальной скорости
                    const hitPoint = (ball.x + BALL_SIZE / 2) - (player1.x + PADDLE_WIDTH / 2);
                    ball.velX += hitPoint * 0.1;
                } else if (ball.y + BALL_SIZE > canvas.height) {
                    // Игрок 1 пропустил мяч
                    player2.score++;
                    updateScoreDisplay();
                    checkWinCondition();
                    if (gameRunning) resetBall();
                }
            }

            // 4. Коллизия с ракеткой Игрока 2 (Сверху)
            if (ball.y < player2.y + PADDLE_HEIGHT) {
                if (ball.x + BALL_SIZE > player2.x && ball.x < player2.x + PADDLE_WIDTH) {
                    ball.velY = -ball.velY; // Отскок от ракетки 2
                    // Корректировка горизонтальной скорости
                    const hitPoint = (ball.x + BALL_SIZE / 2) - (player2.x + PADDLE_WIDTH / 2);
                    ball.velX += hitPoint * 0.1;
                } else if (ball.y < 0) {
                    // Игрок 2 пропустил мяч
                    player1.score++;
                    updateScoreDisplay();
                    checkWinCondition();
                    if (gameRunning) resetBall();
                }
            }
            
            // 5. Простое управление AI для игрока 2 (сверху)
            const centerP2 = player2.x + PADDLE_WIDTH / 2;
            const targetX = ball.x + BALL_SIZE / 2; // Центр мяча
            const aiSpeed = 4;

            if (targetX > centerP2 + 10) {
                player2.x = Math.min(player2.x + aiSpeed, canvas.width - PADDLE_WIDTH);
            } else if (targetX < centerP2 - 10) {
                player2.x = Math.max(player2.x - aiSpeed, 0);
            }

            // Ограничение движения ракеток по X
            player1.x = Math.max(0, Math.min(player1.x, canvas.width - PADDLE_WIDTH));
        }

        /** Отрисовка всех элементов */
        function draw() {
            // 1. Очистка холста
            ctx.fillStyle = '#010409';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 2. Центральная линия (теперь горизонтальная)
            ctx.fillStyle = '#38ff38';
            ctx.beginPath();
            ctx.setLineDash([10, 5]);
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();

            // 3. Отрисовка ракеток
            ctx.setLineDash([]); // Отключаем пунктир
            // Игрок 1 (снизу)
            ctx.fillRect(player1.x, player1.y, PADDLE_WIDTH, PADDLE_HEIGHT);
            // Игрок 2 (сверху)
            ctx.fillRect(player2.x, player2.y, PADDLE_WIDTH, PADDLE_HEIGHT);

            // 4. Отрисовка мяча
            ctx.fillRect(ball.x, ball.y, BALL_SIZE, BALL_SIZE);
        }

        /** Игровой цикл */
        function animate() {
            update();
            draw();
            animationFrameId = requestAnimationFrame(animate);
        }

        /** Обновление счета в HTML */
        function updateScoreDisplay() {
            // Игрок 1 (Человек) : Игрок 2 (AI)
            scoreP1.textContent = player1.score;
            scoreP2.textContent = player2.score;
        }

        // --- Управление вводом (Клавиатура и Тач) ---

        // Управление клавиатурой (для Игрока 1)
        const keys = {};
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
        });
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Влияние нажатых клавиш на движение ракетки Игрока 1 (теперь A/D или стрелки)
        function handleKeyboardInput() {
            const moveSpeed = 8;
            
            // Движение ВЛЕВО (A или Ф (русская) или Стрелка влево)
            if (keys['a'] || keys['ф'] || keys['ArrowLeft']) { 
                player1.x -= moveSpeed;
            } 
            // Движение ВПРАВО (D или В (русская) или Стрелка вправо)
            if (keys['d'] || keys['в'] || keys['ArrowRight']) { 
                player1.x += moveSpeed;
            }
        }
        
        // Включаем обработку клавиатуры в цикле
        const originalUpdate = update;
        update = function() {
            handleKeyboardInput();
            originalUpdate();
        }

        // Управление касаниями (Touch/Swipe)
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Предотвращаем скролл
            const rect = canvas.getBoundingClientRect();
            // Получаем X-координату касания относительно холста
            const touchX = e.touches[0].clientX - rect.left; 

            // Перемещаем ракетку Игрока 1 к центру касания
            player1.x = touchX - PADDLE_WIDTH / 2;
        });
        
        // --- Настройка и ресайз ---
        
        /** Настройка размеров Canvas для адаптивности */
        function resizeCanvas() {
            const container = document.getElementById('game-container');
            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            
            // Определяем максимальную возможную ширину/высоту с сохранением аспекта 3:4
            let newWidth = containerWidth * 0.9; 
            let newHeight = newWidth / ASPECT_RATIO; 
            
            // Если вычисленная высота слишком большая, ограничиваем по высоте
            if (newHeight > containerHeight * 0.8) {
                newHeight = containerHeight * 0.8;
                newWidth = newHeight * ASPECT_RATIO;
            }
            
            canvas.width = newWidth;
            canvas.height = newHeight;
            
            // Если игра уже идет, обновляем положение ракеток и мяча
            if (gameRunning || player1.score > 0 || player2.score > 0) {
                 // Пересчитываем положение ракеток относительно нового размера
                player1.x = canvas.width / 2 - PADDLE_WIDTH / 2;
                player2.x = canvas.width / 2 - PADDLE_WIDTH / 2;
                
                // Фиксируем позиции Y
                player1.y = canvas.height - PADDLE_HEIGHT;
                player2.y = 0;
                
                resetBall();
            } else {
                player1.x = canvas.width / 2 - PADDLE_WIDTH / 2;
                player2.x = canvas.width / 2 - PADDLE_WIDTH / 2;
                player1.y = canvas.height - PADDLE_HEIGHT;
                player2.y = 0;
            }
            
            draw();
        }
        
        // --- Инициализация ---
        
        // Запуск ресайза при загрузке и при изменении размера окна
        window.addEventListener('load', () => {
            resizeCanvas();
            draw(); // Отрисовываем начальное состояние
        });
        window.addEventListener('resize', resizeCanvas);

        // Привязка кнопки к функции запуска
        startButton.addEventListener('click', startGame);

    </script>

</body>
</html>
